{
  "version": 3,
  "sources": ["../src/lzma.js"],
  "sourcesContent": ["//! \u00A9 2015 Nathan Rugg <nmrugg@gmail.com> | MIT\n/// See LICENSE for more details.\n\n// jshint bitwise:true, curly:true, eqeqeq:true, forin:true, immed:true, latedef:true, newcap:true, noarg:true, noempty:true, nonew:true, onevar:true, plusplus:true, quotmark:double, undef:true, unused:strict, browser: true, node: true\n\n/// Does the environment support web workers?  If not, let's load the worker manually (without polluting the global scope).\nif (\n  typeof Worker === \"undefined\" ||\n  (typeof location !== \"undefined\" && location.protocol === \"file:\")\n) {\n  /// Is this Node.js?\n  if (typeof global !== \"undefined\" && typeof require !== \"undefined\") {\n    this.LZMA = function (lzma_path) {\n      return require(lzma_path || \"./lzma_worker.js\").LZMA;\n    };\n    /// Is this a browser?\n  } else if (typeof window !== \"undefined\" && window.document) {\n    (function () {\n      var that = this,\n        global_var,\n        req = function req(path) {\n          var script_tag = document.createElement(\"script\");\n          script_tag.type = \"text/javascript\";\n          script_tag.src = path;\n          script_tag.onload = function () {\n            /// Make sure this LZMA variable doesn't get overwritten by the worker's.\n            that.LZMA = non_worker_lzma;\n          };\n          document.getElementsByTagName(\"head\")[0].appendChild(script_tag);\n        };\n\n      /// Determine the global variable (it's called \"window\" in browsers, \"global\" in Node.js).\n      if (typeof window !== \"undefined\") {\n        global_var = window;\n      } else if (global) {\n        global_var = global;\n      }\n\n      function non_worker_lzma(path) {\n        var fake_lzma;\n\n        req(path);\n\n        fake_lzma = {\n          compress: function compress(mixed, mode, on_finish, on_progress) {\n            if (global_var.LZMA_WORKER) {\n              global_var.LZMA_WORKER.compress(\n                mixed,\n                mode,\n                on_finish,\n                on_progress\n              );\n            } else {\n              /// Wait\n              setTimeout(function () {\n                fake_lzma.compress(mixed, mode, on_finish, on_progress);\n              }, 50);\n            }\n          },\n          decompress: function decompress(byte_arr, on_finish, on_progress) {\n            if (global_var.LZMA_WORKER) {\n              global_var.LZMA_WORKER.decompress(\n                byte_arr,\n                on_finish,\n                on_progress\n              );\n            } else {\n              /// Wait\n              setTimeout(function () {\n                fake_lzma.decompress(byte_arr, on_finish, on_progress);\n              }, 50);\n            }\n          },\n          worker: function worker() {\n            return null;\n          },\n        };\n\n        return fake_lzma;\n      }\n\n      that.LZMA = non_worker_lzma;\n    })();\n  } else {\n    /// It doesn't seem to be either Node.js or a browser.\n    console.error(\"Can't load the worker. Sorry.\");\n  }\n} else {\n  /// Let's use Web Workers.\n  ///NOTE: The \"this\" keyword is the global context (\"window\" variable) if loaded via a <script> tag\n  ///      or the function context if loaded as a module (e.g., in Node.js).\n  this.LZMA = function (lzma_path) {\n    var action_compress = 1,\n      action_decompress = 2,\n      action_progress = 3,\n      callback_obj = {},\n      ///NOTE: Node.js needs something like \"./\" or \"../\" at the beginning.\n      lzma_worker = new Worker(lzma_path || \"./lzma_worker.js\");\n\n    lzma_worker.onmessage = function onmessage(e) {\n      if (e.data.action === action_progress) {\n        if (\n          callback_obj[e.data.cbn] &&\n          typeof callback_obj[e.data.cbn].on_progress === \"function\"\n        ) {\n          callback_obj[e.data.cbn].on_progress(e.data.result);\n        }\n      } else {\n        if (\n          callback_obj[e.data.cbn] &&\n          typeof callback_obj[e.data.cbn].on_finish === \"function\"\n        ) {\n          callback_obj[e.data.cbn].on_finish(e.data.result, e.data.error);\n\n          /// Since the (de)compression is complete, the callbacks are no longer needed.\n          delete callback_obj[e.data.cbn];\n        }\n      }\n    };\n\n    /// Very simple error handling.\n    lzma_worker.onerror = function (event) {\n      var err = new Error(\n        event.message + \" (\" + event.filename + \":\" + event.lineno + \")\"\n      );\n\n      for (var cbn in callback_obj) {\n        callback_obj[cbn].on_finish(null, err);\n      }\n\n      console.error(\"Uncaught error in lzma_worker\", err);\n    };\n\n    return (function () {\n      function send_to_worker(action, data, mode, on_finish, on_progress) {\n        var cbn;\n\n        do {\n          cbn = Math.floor(Math.random() * 10000000);\n        } while (typeof callback_obj[cbn] !== \"undefined\");\n\n        callback_obj[cbn] = {\n          on_finish: on_finish,\n          on_progress: on_progress,\n        };\n\n        lzma_worker.postMessage({\n          action: action, /// action_compress = 1, action_decompress = 2, action_progress = 3\n          cbn: cbn, /// callback number\n          data: data,\n          mode: mode,\n        });\n      }\n\n      return {\n        compress: function compress(mixed, mode, on_finish, on_progress) {\n          send_to_worker(action_compress, mixed, mode, on_finish, on_progress);\n        },\n        decompress: function decompress(byte_arr, on_finish, on_progress) {\n          send_to_worker(\n            action_decompress,\n            byte_arr,\n            false,\n            on_finish,\n            on_progress\n          );\n        },\n        worker: function worker() {\n          return lzma_worker;\n        },\n      };\n    })();\n  };\n}\n"],
  "mappings": "AAAA,AAMA,AACE,MAAO,SAAW,aACjB,MAAO,WAAa,aAAe,SAAS,WAAa,QAG1D,AAAI,MAAO,SAAW,aAAe,MAAO,UAAY,YACtD,QAAK,KAAO,SAAU,EAAW,CAC/B,MAAO,SAAQ,GAAa,oBAAoB,MAG7C,AAAI,MAAO,SAAW,aAAe,OAAO,SAChD,UAAY,CACX,GAAI,GAAO,KACT,EACA,EAAM,SAAa,EAAM,CACvB,GAAI,GAAa,SAAS,cAAc,UACxC,EAAW,KAAO,kBAClB,EAAW,IAAM,EACjB,EAAW,OAAS,UAAY,CAE9B,EAAK,KAAO,GAEd,SAAS,qBAAqB,QAAQ,GAAG,YAAY,IAIzD,AAAI,MAAO,SAAW,YACpB,EAAa,OACJ,QACT,GAAa,QAGf,WAAyB,EAAM,CAC7B,GAAI,GAEJ,SAAI,GAEJ,EAAY,CACV,SAAU,SAAkB,EAAO,EAAM,EAAW,EAAa,CAC/D,AAAI,EAAW,YACb,EAAW,YAAY,SACrB,EACA,EACA,EACA,GAIF,WAAW,UAAY,CACrB,EAAU,SAAS,EAAO,EAAM,EAAW,IAC1C,KAGP,WAAY,SAAoB,EAAU,EAAW,EAAa,CAChE,AAAI,EAAW,YACb,EAAW,YAAY,WACrB,EACA,EACA,GAIF,WAAW,UAAY,CACrB,EAAU,WAAW,EAAU,EAAW,IACzC,KAGP,OAAQ,UAAkB,CACxB,MAAO,QAIJ,EAGT,EAAK,KAAO,KAId,QAAQ,MAAM,iCAMhB,QAAK,KAAO,SAAU,EAAW,CAC/B,GAAI,GAAkB,EACpB,EAAoB,EACpB,EAAkB,EAClB,EAAe,GAEf,EAAc,GAAI,QAAO,GAAa,oBAExC,SAAY,UAAY,SAAmB,EAAG,CAC5C,AAAI,EAAE,KAAK,SAAW,EAElB,EAAa,EAAE,KAAK,MACpB,MAAO,GAAa,EAAE,KAAK,KAAK,aAAgB,YAEhD,EAAa,EAAE,KAAK,KAAK,YAAY,EAAE,KAAK,QAI5C,EAAa,EAAE,KAAK,MACpB,MAAO,GAAa,EAAE,KAAK,KAAK,WAAc,YAE9C,GAAa,EAAE,KAAK,KAAK,UAAU,EAAE,KAAK,OAAQ,EAAE,KAAK,OAGzD,MAAO,GAAa,EAAE,KAAK,OAMjC,EAAY,QAAU,SAAU,EAAO,CACrC,GAAI,GAAM,GAAI,OACZ,EAAM,QAAU,KAAO,EAAM,SAAW,IAAM,EAAM,OAAS,KAG/D,OAAS,KAAO,GACd,EAAa,GAAK,UAAU,KAAM,GAGpC,QAAQ,MAAM,gCAAiC,IAGzC,UAAY,CAClB,WAAwB,EAAQ,EAAM,EAAM,EAAW,EAAa,CAClE,GAAI,GAEJ,EACE,GAAM,KAAK,MAAM,KAAK,SAAW,WAC1B,MAAO,GAAa,IAAS,aAEtC,EAAa,GAAO,CAClB,UAAW,EACX,YAAa,GAGf,EAAY,YAAY,CACtB,OAAQ,EACR,IAAK,EACL,KAAM,EACN,KAAM,IAIV,MAAO,CACL,SAAU,SAAkB,EAAO,EAAM,EAAW,EAAa,CAC/D,EAAe,EAAiB,EAAO,EAAM,EAAW,IAE1D,WAAY,SAAoB,EAAU,EAAW,EAAa,CAChE,EACE,EACA,EACA,GACA,EACA,IAGJ,OAAQ,UAAkB,CACxB,MAAO",
  "names": []
}
